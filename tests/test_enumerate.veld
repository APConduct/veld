# Test: enumerate() array method

# Test 1: Basic enumerate with strings
std.io.println("Test 1: Basic enumerate with strings")
let fruits = ["apple", "banana", "cherry"]
let indexed = fruits.enumerate()

for (i, fruit) in indexed do
    std.io.println("  " + i.to_str() + ": " + fruit)
end

# Test 2: Enumerate with numbers
std.io.println("\nTest 2: Enumerate with numbers")
let numbers = [10, 20, 30, 40, 50]
let indexed_nums = numbers.enumerate()

for (idx, value) in indexed_nums do
    std.io.println("  Index " + idx.to_str() + " = " + value.to_str())
end

# Test 3: Empty array
std.io.println("\nTest 3: Empty array")
let empty = []
let empty_indexed = empty.enumerate()
std.io.println("  Length: " + empty_indexed.len().to_str())

# Test 4: Single element
std.io.println("\nTest 4: Single element")
let single = ["only"]
let single_indexed = single.enumerate()
for (i, val) in single_indexed do
    std.io.println("  " + i.to_str() + ": " + val)
end

# Test 5: Access by index (enumerate result is regular array)
std.io.println("\nTest 5: Access by index")
let colors = ["red", "green", "blue"]
let color_idx = colors.enumerate()
let first = color_idx.first()
match first
    Option.Some(pair) => do
        let (idx, color) = pair
        std.io.println("  First: index=" + idx.to_str() + ", color=" + color)
    end
    Option.None => std.io.println("  None")
end

# Test 6: Chaining with filter
std.io.println("\nTest 6: Enumerate then filter")
let nums = [1, 2, 3, 4, 5, 6]
let indexed_nums2 = nums.enumerate()
let evens_with_idx = indexed_nums2.filter((pair) => do
    let (i, n) = pair
    n % 2 == 0
end)

std.io.println("  Even numbers with their indices:")
for (idx, val) in evens_with_idx do
    std.io.println("    Index " + idx.to_str() + ": " + val.to_str())
end

# Test 7: Enumerate then map
std.io.println("\nTest 7: Enumerate then map")
let words = ["hello", "world", "test"]
let formatted = words.enumerate().map((pair) => do
    let (i, word) = pair
    i.to_str() + ". " + word
end)

for item in formatted do
    std.io.println("  " + item)
end

# Test 8: Using enumerate for running total with index
std.io.println("\nTest 8: Running sum with indices")
let values = [5, 10, 15, 20]
let indexed_values = values.enumerate()
let running_sum = indexed_values.reduce(0, (acc, pair) => do
    let (idx, val) = pair
    std.io.println("  Step " + idx.to_str() + ": adding " + val.to_str())
    acc + val
end)
std.io.println("  Final sum: " + running_sum.to_str())

# Test 9: Enumerate with tuples
std.io.println("\nTest 9: Enumerate with tuples")
let pairs = [(1, "one"), (2, "two"), (3, "three")]
let indexed_pairs = pairs.enumerate()
for (i, pair) in indexed_pairs do
    let (num, word) = pair
    std.io.println("  " + i.to_str() + ": (" + num.to_str() + ", " + word + ")")
end

# Test 10: Finding index of first match
std.io.println("\nTest 10: Find index of first match")
let items = ["cat", "dog", "bird", "fish"]
let found = items.enumerate().find((pair) => do
    let (i, animal) = pair
    animal == "bird"
end)

match found
    Option.Some(pair) => do
        let (idx, animal) = pair
        std.io.println("  Found '" + animal + "' at index " + idx.to_str())
    end
    Option.None => std.io.println("  Not found")
end

std.io.println("\nAll enumerate() tests completed!")
